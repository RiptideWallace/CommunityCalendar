<!-- views/search.ejs -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <title>
      Events at <%= place.place_name %> - Victoria Community Calendar
    </title>
    <% include partials/_head.ejs %>
  </head>

  <body>

    <% include partials/_header.ejs %>

    <div class="container">

      <h3>Events at <%= place.place_name %></h3>

      <div class="well">
        <h4>Location details</h4>
        <p><strong><%= place.place_name %></strong> in <strong><%= place.region_name %></strong></p>
        <p>Address: <%= place.street_address %></p>
        <div id="map" class="map-place-event-search"></div>
        <% if (userId) { %>
          <div>
            <form action="/place/saved/<%= place.place_id %>/<%= userId %>" method="POST">
              <button type="submit" class="btn btn-block btn-primary favourite-button">
                <i class="fa fa-heart" aria-hidden="true"></i>
                <span>&nbsp Add this place to favourites</span>
              </button>
            </form>
          </div>
        <% } %>
      </div>

      <% if (!activities.length) { %>
        <h3>No activities for this place. <i class="fa fa-frown-o" aria-hidden="true"></i></h3>
      <% } else { %>
        <div>
          <% activities.forEach(function(a) { %>
            <div class="well">
              <h2><a href="/BC/<%=place.region_slug%>/<%=place.place_slug%>/<%=a.slug%>"><%= a.name %></a></h2>
              <h3>at <%= place.place_name %></h3>
              <p>Address: <%= place.street_address %>, <%= place.region_name %></p>
              <p><%= a.description %></p>
              <% if (a.start_date === a.end_date) { %>
                <p>Date: <%= a.start_date %></p>
              <% } else { %>
              <p>Starts: <%= a.start_date %></p>
              <p>Ends: <%= a.end_date %></p>
              <% } %>
              <p>Price:</p>
              <div class="price-box">
                <% if (a.price_range === 0) { %>
                  <p class="price-range">Free!</p>
                <% } else { %>
                  <% for (p = 0; p < a.price_range; p++) { %><span class="glyphicon glyphicon-usd price-range" aria-hidden="true"></span><% } %>
                  / <span class="glyphicon glyphicon-usd price-denominator" aria-hidden="true"></span><span class="glyphicon glyphicon-usd price-denominator" aria-hidden="true"></span><span class="glyphicon glyphicon-usd price-denominator" aria-hidden="true"></span>
                <% } %>
              </div>
              <p><a href="<%= a.source %>" title="<%= a.name %>">Source</a></p>
            </div>
          <% } ) %>
        </div>
      <% } %>

    </div>

    <% include partials/_footer.ejs %>

    <script>
      var map;
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: <%= place.latitude %>, lng: <%= place.longitude %>},
          zoom: 16
        });
      }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=<%= apiKey %>&callback=initMap"></script>
  </body>
</html>
